#!/usr/bin/env python3
# -*- coding: utf-8 -*-

from optparse import OptionParser
usage = "usage: %prog [options] <input txt file> <output file name>"
parser = OptionParser(usage=usage)
parser.add_option("-d", "--delimiter", dest = "delimiter",
                  default=" ")

(options,args) = parser.parse_args()

input_file_str = args[0]
output_file_str = args[1]

import pandas as pd
import numpy as np
df = pd.read_csv(input_file_str, delimiter=options.delimiter)
#df.to_hdf("{}.h5".format(output_file_str), key='df')

for k in df:
    if any([s in k for s in ["is_", "was_"]]):
        df[k] = df[k].astype('bool')

    elif any([s in k for s in ["_eta", "_phi", "_deepFlavor"]]):
        df[k] = df[k].astype('float16')

    elif df[k].dtype == 'float64':
        df[k] = df[k].astype('float32')

    elif df[k].dtype == 'int64':
        df[k] = df[k].astype('int16')

    elif any([s in k for s in ["PU_"]]):
        df[k] = df[k].astype('int16')

df.to_hdf("{}.h5".format(output_file_str), key='df')


#import pandas as pd
#
#output_file_str = "events_bbtautau_2017_SR"
#
#df1 = pd.read_hdf("GGHH_NLO_cHHH1_SR.h5")
#df2 = pd.read_hdf("VBFHH_CV_1_C2V_1_C3_1_SR.h5")
#df3 = pd.read_hdf("DY_SR.h5")
#df4 = pd.read_hdf("TT_semiLep_SR.h5")
#
#frames = [df1, df2, df3, df4]
#
#df = pd.concat(frames)
#
#df.to_hdf("{}.h5".format(output_file_str), key='df')
#
#import pandas as pd
#df = pd.read_hdf("events_bbtautau_2017_SR.h5")
#df = df.sample(frac=1).reset_index(drop=True)
#df.to_hdf("events_bbtautau_2017_SR_shuffled.h5", key='df')
